<div class="bg-decoration"></div>

<header class="header">
  <div class="logo-container">
    <div class="logo">
      <i class="fas fa-laptop"></i>
    </div>
    <div>
      <h1 class="org-name">Amigos de Santa Cruz</h1>
      <p class="system-title">Sistema de Gestión de Equipos</p>
    </div>
  </div>
</header>

<main class="main-container">
  <div class="login-card">
    <div class="welcome-text">
      <h2 class="welcome-title">Restablecer Contraseña</h2>
      <p class="welcome-subtitle">Ingresa tu email y tu nueva contraseña</p>
    </div>

    <form [formGroup]="form" (ngSubmit)="submit()">

      <div class="form-group">
        <label for="email" class="form-label">Email</label>
        <div class="input-container">
          <input
            type="email"
            id="email"
            class="form-input"
            placeholder="Ingresa tu email registrado"
            formControlName="email"
            [ngClass]="{ 'error': isInvalid('email'), 'success': isValid('email') }"
          >
          <i class="fas fa-at input-icon"></i>
        </div>
        <div *ngIf="isInvalid('email')" class="error-message">
          <span *ngIf="form.get('email')?.errors?.['required']">El email es obligatorio.</span>
          <span *ngIf="form.get('email')?.errors?.['email']">Por favor, ingresa un email válido.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="nuevaContraseña" class="form-label">Nueva Contraseña</label>
        <div class="input-container">
          <input
            [type]="passwordFieldType"
            id="nuevaContraseña"
            class="form-input"
            placeholder="Ingresa tu nueva contraseña"
            formControlName="nuevaContraseña"
            [ngClass]="{ 'error': isInvalid('nuevaContraseña'), 'success': isValid('nuevaContraseña') }"
          >
          <i class="fas fa-lock input-icon"></i>
          <i
            class="password-toggle"
            [ngClass]="passwordFieldType === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash'"
            (click)="togglePasswordVisibility()"
          ></i>
        </div>
        <div *ngIf="isInvalid('nuevaContraseña')" class="error-message">
          <span *ngIf="form.get('nuevaContraseña')?.errors?.['required']">La contraseña es obligatoria.</span>
          <span *ngIf="form.get('nuevaContraseña')?.errors?.['minlength']">Debe tener al menos 6 caracteres.</span>
        </div>
      </div>

      <div *ngIf="apiError" class="error-message api-error">
        {{ apiError }}
      </div>

      <div *ngIf="successMessage" class="success-notification">
        <i class="fas fa-check-circle icon"></i>
        <span class="message">{{ successMessage }}</span>
      </div>

      <button
        type="submit"
        class="login-button"
        [disabled]="loading || form.disabled"
      >
        <ng-container *ngIf="!loading; else loadingState">
          <span>Restablecer Contraseña</span>
        </ng-container>
        <ng-template #loadingState>
          <div class="loading-spinner"></div>
          <span>Actualizando...</span>
        </ng-template>
      </button>

      <div class="text-center">
        <a
          [routerLink]="['/login']"
          class="forgot-link"
          style="color: #114495; font-weight: 500;"
        >
          Volver a Iniciar sesión
        </a>
      </div>

    </form>

  </div> </main>

<footer class="footer">
  <p>&copy; 2025 Amigos de Santa Cruz ONG - Sistema desarrollado por Cristian Mendoza</p>
</footer>
