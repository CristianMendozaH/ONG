<header class="header">
  <div class="header-left">
    <h1>Reportes y Analítica</h1>
    <div class="breadcrumb">
      <a href="#">Dashboard</a>
      <i class="fas fa-chevron-right"></i>
      <span>Reportes</span>
    </div>
  </div>
</header>

<div *ngIf="hasError" class="error-message">
  <i class="fas fa-exclamation-triangle"></i>
  {{ errorMessage }}
</div>

<div *ngIf="isLoading" class="loading-container">
  <div class="spinner"></div>
  <p>Cargando datos...</p>
</div>

<div class="reports-content" *ngIf="!isLoading">
  <div class="main-section">
    <div class="filters-section">
      <h3 class="filters-section-title">
        <i class="fas fa-filter"></i>
        Filtros de Búsqueda
      </h3>
      <div class="filters-section-grid">
        <div class="filter-group">
          <label class="filter-label">Fecha de Inicio</label>
          <input type="date" class="filter-input" [(ngModel)]="filtros.fechaInicio">
        </div>
        <div class="filter-group">
          <label class="filter-label">Fecha de Fin</label>
          <input type="date" class="filter-input" [(ngModel)]="filtros.fechaFin">
        </div>
        <div class="filter-group">
          <label class="filter-label">Tipo de Reporte</label>
          <select class="filter-select" [(ngModel)]="filtros.tipoReporte">
            <option *ngFor="let tipo of tiposReporte" [value]="tipo.value">{{ tipo.label }}</option>
          </select>
        </div>
      </div>
      <div class="filters-section-actions">
        <button class="btn-clear" (click)="limpiarFiltros()"><i class="fas fa-times"></i> Limpiar</button>
        <button class="btn-filter" (click)="aplicarFiltros()"><i class="fas fa-search"></i> Buscar</button>
      </div>
    </div>

    <div class="reports-table-container">
      <div class="table-header">
        <h3 class="table-header-title">Resultados del Reporte</h3>
        <div class="export-buttons">
          <button class="btn-export-pdf" (click)="exportarPDF()"><i class="fas fa-file-pdf"></i> Exportar PDF</button>
          <button class="btn-export-excel" (click)="exportarExcel()"><i class="fas fa-file-excel"></i> Exportar Excel</button>
        </div>
      </div>

      <table class="reports-table">
        <ng-container [ngSwitch]="filtros.tipoReporte">

          <thead *ngSwitchCase="'mantenimiento'">
            <tr>
              <th>ID</th>
              <th>Equipo</th>
              <th>Tipo</th>
              <th>Técnico</th>
              <th>Fecha Realización</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody *ngSwitchCase="'mantenimiento'">
            <tr *ngFor="let reporte of reportes; trackBy: trackByReporte">
              <td>{{ reporte.correlativo | padNumber:3 }}</td>
              <td>{{ reporte.equipo }} ({{ reporte.codigoEquipo }})</td>
              <td>{{ reporte.tipo }}</td>
              <td>{{ reporte.tecnico || '-' }}</td>
              <td>{{ reporte.fechaRealizacion | date:'yyyy-MM-dd' }}</td>
              <td><span class="status-badge">{{ reporte.estado }}</span></td>
            </tr>
          </tbody>

          <thead *ngSwitchDefault>
            <tr>
              <th>ID</th>
              <th>Equipo</th>
              <th>Usuario</th>
              <th>Fecha Préstamo</th>
              <th>Fecha Devolución</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody *ngSwitchDefault>
            <tr *ngFor="let reporte of reportes; trackBy: trackByReporte">
              <td>{{ reporte.correlativo | padNumber:3 }}</td>
              <td>{{ reporte.equipo }}</td>
              <td>{{ reporte.usuario }}</td>
              <td>{{ reporte.fechaPrestamo | date:'yyyy-MM-dd' }}</td>
              <td>{{ reporte.fechaDevolucion ? (reporte.fechaDevolucion | date:'yyyy-MM-dd') : '-' }}</td>
              <td>
                <span class="status-badge" [class]="getEstadoClass(reporte.estado)">{{ reporte.estado }}</span>
              </td>
            </tr>
          </tbody>
        </ng-container>

        <tr *ngIf="!reportes || reportes.length === 0">
          <td colspan="7" class="empty-state">
            <i class="fas fa-inbox"></i>
            <p>No se encontraron reportes con los filtros aplicados</p>
          </td>
        </tr>
      </table>

      <div class="pagination" *ngIf="totalItems > itemsPerPage">
        <button class="pagination-btn" [disabled]="currentPage === 1" (click)="cambiarPagina(currentPage - 1)">
          <i class="fas fa-chevron-left"></i>
        </button>
        <span class="pagination-info">Página {{ currentPage }} de {{ totalPages }}</span>
        <button class="pagination-btn" [disabled]="currentPage >= totalPages" (click)="cambiarPagina(currentPage + 1)">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <div class="charts-panel">
    <div class="chart-card">
      <h3 class="chart-card-title"><i class="fas fa-chart-bar"></i> Estadísticas Generales</h3>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-number">{{ totalPrestamos }}</div>
          <div class="stat-label">Total Préstamos</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ totalDevueltos }}</div>
          <div class="stat-label">Devueltos</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ totalActivos }}</div>
          <div class="stat-label">Activos</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ totalVencidos }}</div>
          <div class="stat-label">Vencidos</div>
        </div>
      </div>
    </div>
    <div class="chart-card">
      <h3 class="chart-card-title"><i class="fas fa-chart-pie"></i> Distribución por Estado</h3>
      <div class="status-distribution">
        <div class="status-item">
          <div class="status-color status-active"></div>
          <span>Activos: {{ totalActivos }}</span>
        </div>
        <div class="status-item">
          <div class="status-color status-returned"></div>
          <span>Devueltos: {{ totalDevueltos }}</span>
        </div>
        <div class="status-item">
          <div class="status-color status-overdue"></div>
          <span>Vencidos: {{ totalVencidos }}</span>
        </div>
      </div>
    </div>
    <div class="chart-card">
      <h3 class="chart-card-title"><i class="fas fa-tools"></i> Acciones Rápidas</h3>
      <div class="quick-actions">
        <button class="quick-action-btn" (click)="refrescarDatos()"><i class="fas fa-sync"></i> Refrescar Datos</button>
        <button class="quick-action-btn" (click)="limpiarFiltros()"><i class="fas fa-eraser"></i> Limpiar Filtros</button>
      </div>
    </div>
  </div>
</div>
